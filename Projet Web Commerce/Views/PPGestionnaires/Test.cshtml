@model Projet_Web_Commerce.Models.OrderPercentagesViewModel

@{
    ViewData["Title"] = "Test";
}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>

<canvas id="orderChart" style="width:100%;max-width:700px"></canvas>

<script>

    function generateRandomColor() {
        var r = Math.floor(Math.random() * 256);
        var g = Math.floor(Math.random() * 256);
        var b = Math.floor(Math.random() * 256);
        var a = 0.2;
        return `rgba(${r}, ${g}, ${b}, ${a})`;
    }

    var orderPercentages = @Html.Raw(Json.Serialize(Model.OrderPercentages));

    console.log("orderPercentages List:", orderPercentages);

    var totalOrders = 0;
    for (var i = 0; i < orderPercentages.length; i++) {
        totalOrders += orderPercentages[i].percentage;
    }

    if (Array.isArray(orderPercentages) && orderPercentages.length > 0) {
        var labels = orderPercentages.map(op => op.vendeurName);
        var data = orderPercentages.map(op => op.percentage);
        console.log("orderPercentages Label:", labels);
        console.log("orderPercentages Data:", data);
        var backgroundColors = [];
        for (var i = 0; i < orderPercentages.length; i++) {
            backgroundColors.push(generateRandomColor());
        }

        var ctx = document.getElementById('orderChart').getContext('2d');
        var chart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: backgroundColors
                }]
            },

            options: {
                title: {
                    display: true,
                    text: 'Pourcentage des ventes par vendeur'
                },
                tooltips: {
                    callbacks: {
                        label: function (tooltipItem, data) {
                            var label = data.labels[tooltipItem.index] || '';
                            var value = data.datasets[0].data[tooltipItem.index] || 0;
                            var percentage = ((value / totalOrders) * 100).toFixed(2) + '%';
                            var info = label + ': ' + value + ' (' + percentage + ')';
                            console.log("LABEL ", info)
                            return info;
                        }
                    }
                }
            }
        });
    } else {
        console.log("Aucune donnée n'est disponible pour afficher le graphique.");
    }

</script>


